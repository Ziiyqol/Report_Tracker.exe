name: Build and Release

on:
  release:
    types: [created]

jobs:
  # ------------------------------------------------------------------
<<<<<<< HEAD
  # JOB 1: Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð´Ð»Ñ Windows
  # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ fyne-cross Ð½Ð° Linux-Ð¼Ð°ÑˆÐ¸Ð½Ðµ (ÑÐ°Ð¼Ñ‹Ð¹ ÑÑ‚Ð°Ð±Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¼ÐµÑ‚Ð¾Ð´ Ð´Ð»Ñ .exe)
  # ------------------------------------------------------------------
  build_windows:
    name: ðŸ”¨ Build Windows (x64)
=======
  # Ð—ÐÐ”ÐÐ§Ð 1: Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð´Ð»Ñ Windows
  # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ð½Ð° Linux, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ fyne-cross (Docker)
  # Ð­Ñ‚Ð¾ ÑÐ°Ð¼Ñ‹Ð¹ Ð½Ð°Ð´ÐµÐ¶Ð½Ñ‹Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð± ÑÐ¾Ð±Ñ€Ð°Ñ‚ÑŒ .exe
  # ------------------------------------------------------------------
  build_windows:
    name: Build Windows
>>>>>>> ded32fcbdf439059e5e1491c61456ff38952a428
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'
<<<<<<< HEAD
=======

>>>>>>> ded32fcbdf439059e5e1491c61456ff38952a428
      - name: Install fyne-cross
        run: |
          go install github.com/fyne-io/fyne-cross@latest
          echo "$HOME/go/bin" >> $GITHUB_PATH
<<<<<<< HEAD
      - name: Build Windows Binary
=======

      - name: Build Windows Binary
        # Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Windows Ð²ÐµÑ€ÑÐ¸ÑŽ. Ð˜ÐºÐ¾Ð½ÐºÐ° Ð² cmd/icon.png
>>>>>>> ded32fcbdf439059e5e1491c61456ff38952a428
        run: |
          fyne-cross windows -arch amd64 \
            --icon cmd/icon.png \
            --app-id com.report.tracker \
            --name ReportTracker \
            --output ReportTracker
<<<<<<< HEAD
      - name: Prepare Artifact
        run: |
          mv fyne-cross/bin/windows-amd64/ReportTracker.exe ReportTracker_Windows_x64.exe
=======

      - name: Prepare Artifact
        run: |
          # ÐŸÐµÑ€ÐµÐ¼ÐµÑ‰Ð°ÐµÐ¼ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹Ð¹ exe Ð² ÐºÐ¾Ñ€ÐµÐ½ÑŒ Ð¸ Ð´Ð°ÐµÐ¼ Ð½Ð¾Ñ€Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¸Ð¼Ñ
          mv fyne-cross/bin/windows-amd64/ReportTracker.exe ReportTracker_Windows_x64.exe

>>>>>>> ded32fcbdf439059e5e1491c61456ff38952a428
      - name: Upload Release Asset
        uses: softprops/action-gh-release@v1
        with:
          files: ReportTracker_Windows_x64.exe

  # ------------------------------------------------------------------
<<<<<<< HEAD
  # JOB 2: Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð´Ð»Ñ macOS (Intel Ð¸ M1/ARM64)
  # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Fyne CLI Ð½Ð° macOS-Ð¼Ð°ÑˆÐ¸Ð½Ðµ (Ð¾Ð±Ñ…Ð¾Ð´Ð¸Ñ‚ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ SDK Ð¸ Docker)
  # ------------------------------------------------------------------
  build_macos:
    name: ðŸŽ Build macOS (Intel & M1)
=======
  # Ð—ÐÐ”ÐÐ§Ð 2: Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð´Ð»Ñ macOS (Intel Ð¸ M1)
  # Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ð½Ð° Ð½Ð°ÑÑ‚Ð¾ÑÑ‰ÐµÐ¼ macOS.
  # ÐÐ• Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ fyne-cross. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Fyne CLI.
  # ------------------------------------------------------------------
  build_macos:
    name: Build macOS
>>>>>>> ded32fcbdf439059e5e1491c61456ff38952a428
    runs-on: macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
<<<<<<< HEAD
=======

>>>>>>> ded32fcbdf439059e5e1491c61456ff38952a428
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'
<<<<<<< HEAD
      - name: Install Fyne CLI
        # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ fyne package, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ Xcode (ÐµÑÑ‚ÑŒ Ð½Ð° macos-latest)
        run: go install fyne.io/fyne/v2/cmd/fyne@latest

      # --- Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð´Ð»Ñ Intel (amd64) ---
      - name: ðŸ“¦ Package macOS Intel (amd64)
        run: |
          export CGO_ENABLED=1
          export GOOS=darwin
          export GOARCH=amd64
          # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ fyne package (Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹, Ð° Ð½Ðµ cross)
          $HOME/go/bin/fyne package -os darwin -icon cmd/icon.png --appID com.report.tracker --name ReportTracker
          mv ReportTracker.app ReportTracker_Intel.app
          tar -czf ReportTracker_macOS_Intel.tar.gz ReportTracker_Intel.app

      # --- Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð´Ð»Ñ Apple Silicon (arm64/M1) ---
      - name: ðŸ“¦ Package macOS Apple Silicon (arm64)
=======

      - name: Install Fyne CLI
        # Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½ÑƒÑŽ ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚Ñƒ Fyne v2
        run: go install fyne.io/fyne/v2/cmd/fyne@latest

      # --- Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð´Ð»Ñ Intel (amd64) ---
      - name: Build macOS Intel
        run: |
          # Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ñ†ÐµÐ»ÐµÐ²Ð¾Ð¹ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹
          export CGO_ENABLED=1
          export GOOS=darwin
          export GOARCH=amd64
          
          # Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð°ÐºÐµÑ‚ .app
          fyne package -os darwin -icon cmd/icon.png --appID com.report.tracker --name ReportTracker
          
          # ÐŸÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ñ‹Ð²Ð°ÐµÐ¼, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ðµ Ð±Ñ‹Ð»Ð¾ ÐºÐ¾Ð½Ñ„Ð»Ð¸ÐºÑ‚Ð¾Ð²
          mv ReportTracker.app ReportTracker_Intel.app
          
          # ÐÑ€Ñ…Ð¸Ð²Ð¸Ñ€ÑƒÐµÐ¼ Ð² tar.gz (Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ Ð´Ð»Ñ macOS Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¹)
          tar -czf ReportTracker_macOS_Intel.tar.gz ReportTracker_Intel.app

      # --- Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð´Ð»Ñ Apple Silicon (arm64/M1) ---
      - name: Build macOS Apple Silicon
>>>>>>> ded32fcbdf439059e5e1491c61456ff38952a428
        run: |
          export CGO_ENABLED=1
          export GOOS=darwin
          export GOARCH=arm64
<<<<<<< HEAD
          $HOME/go/bin/fyne package -os darwin -icon cmd/icon.png --appID com.report.tracker --name ReportTracker
          mv ReportTracker.app ReportTracker_M1.app
=======
          
          # Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð¿Ð°ÐºÐµÑ‚ .app
          fyne package -os darwin -icon cmd/icon.png --appID com.report.tracker --name ReportTracker
          
          # ÐŸÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ñ‹Ð²Ð°ÐµÐ¼
          mv ReportTracker.app ReportTracker_M1.app
          
          # ÐÑ€Ñ…Ð¸Ð²Ð¸Ñ€ÑƒÐµÐ¼
>>>>>>> ded32fcbdf439059e5e1491c61456ff38952a428
          tar -czf ReportTracker_macOS_M1.tar.gz ReportTracker_M1.app

      - name: Upload Release Assets
        uses: softprops/action-gh-release@v1
<<<<<<< HEAD
=======
        if: startsWith(github.ref, 'refs/tags/')
>>>>>>> ded32fcbdf439059e5e1491c61456ff38952a428
        with:
          files: |
            ReportTracker_macOS_Intel.tar.gz
            ReportTracker_macOS_M1.tar.gz
