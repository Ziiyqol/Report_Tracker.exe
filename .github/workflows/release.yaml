name: Build and Release

on:
  release:
    types: [created]

jobs:
  # ------------------------------------------------------------------
  # JOB 1: Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð´Ð»Ñ Windows
  # ------------------------------------------------------------------
  build_windows:
    name: ðŸ”¨ Build Windows (x64)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'
      - name: Install fyne-cross
        run: |
          go install github.com/fyne-io/fyne-cross@latest
          echo "$HOME/go/bin" >> $GITHUB_PATH
      - name: Build Windows Binary
        run: |
          fyne-cross windows -arch amd64 \
            -workdir cmd \  # <--- Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ -workdir Ð´Ð»Ñ ÑƒÐºÐ°Ð·Ð°Ð½Ð¸Ñ Ð¿Ð°Ð¿ÐºÐ¸ main
            --icon cmd/icon.png \
            --app-id com.report.tracker \
            --name ReportTracker \
            --output ReportTracker
      - name: Prepare Artifact
        run: |
          mv fyne-cross/bin/windows-amd64/ReportTracker.exe ReportTracker_Windows_x64.exe
      - name: Upload Release Asset
        uses: softprops/action-gh-release@v1
        with:
          files: ReportTracker_Windows_x64.exe

  # ------------------------------------------------------------------
  # JOB 2: Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð´Ð»Ñ macOS (Intel Ð¸ M1/ARM64)
  # ------------------------------------------------------------------
  build_macos:
    name: ðŸŽ Build macOS (Intel & M1)
    runs-on: macos-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'
      - name: Install Fyne CLI
        run: go install fyne.io/fyne/v2/cmd/fyne@latest

      # --- Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð´Ð»Ñ Intel (amd64) ---
      - name: ðŸ“¦ Package macOS Intel (amd64)
        run: |
          export CGO_ENABLED=1
          export GOOS=darwin
          export GOARCH=amd64
          # Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ --sourceDir cmd
          $HOME/go/bin/fyne package -os darwin --sourceDir cmd -icon cmd/icon.png --appID com.report.tracker --name ReportTracker
          mv ReportTracker.app ReportTracker_Intel.app
          tar -czf ReportTracker_macOS_Intel.tar.gz ReportTracker_Intel.app

      # --- Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð´Ð»Ñ Apple Silicon (arm64/M1) ---
      - name: ðŸ“¦ Package macOS Apple Silicon (arm64)
        run: |
          export CGO_ENABLED=1
          export GOOS=darwin
          export GOARCH=arm64
          # Ð˜Ð¡ÐŸÐ ÐÐ’Ð›Ð•ÐÐ˜Ð•: Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ --sourceDir cmd
          $HOME/go/bin/fyne package -os darwin --sourceDir cmd -icon cmd/icon.png --appID com.report.tracker --name ReportTracker
          mv ReportTracker.app ReportTracker_M1.app
          tar -czf ReportTracker_macOS_M1.tar.gz ReportTracker_M1.app

      - name: Upload Release Assets
        uses: softprops/action-gh-release@v1
        with:
          files: |
            ReportTracker_macOS_Intel.tar.gz
            ReportTracker_macOS_M1.tar.gz